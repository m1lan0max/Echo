<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéâ College Party Tickets - Get Your Pass!</title>

    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* ==========================
           GLOBAL STYLE
        ========================== */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
        body {
            background: url("zizo.jpg") center/cover no-repeat fixed;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Gradient Overlay */
        .gradient-overlay {
            position: fixed; inset: 0;
            background: linear-gradient(130deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02));
            mix-blend-mode: screen;
            pointer-events: none;
            animation: glowMove 15s ease-in-out infinite alternate;
        }
        @keyframes glowMove {
            0% { transform: translate3d(-5%, -5%, 0) scale(1); }
            50% { transform: translate3d(5%, 5%, 0) scale(1.05); }
            100% { transform: translate3d(-3%, 3%, 0) scale(1.02); }
        }

        /* Floating bubbles */
        .bubble { position: fixed; border-radius: 50%; filter: blur(2px); opacity: 0.5; mix-blend-mode: screen; animation: floatUp 20s linear infinite; }
        .bubble:nth-child(1){ width:220px;height:220px;background:radial-gradient(circle,#ffdd59,#ff3f34);bottom:-220px;left:5%;animation-duration:22s;}
        .bubble:nth-child(2){ width:150px;height:150px;background:radial-gradient(circle,#0be881,#1e90ff);bottom:-150px;left:60%;animation-duration:18s;animation-delay:-4s;}
        .bubble:nth-child(3){ width:280px;height:280px;background:radial-gradient(circle,#ff5e57,#9b59b6);bottom:-280px;right:-40px;animation-duration:26s;animation-delay:-9s;}
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            10%,80% { opacity: 0.7; }
            100% { transform: translateY(-130vh) scale(1.1); opacity: 0; }
        }

        /* Layout wrapper */
        .page { position: relative; z-index: 10; display: flex; justify-content: center; padding: 3rem 1rem; }

        /* Glass card */
        .card {
            width: 100%; max-width: 900px;
            background: rgba(8, 8, 20, 0.75);
            border-radius: 24px;
            padding: 2.5rem;
            border: 1px solid rgba(255,255,255,0.12);
            backdrop-filter: blur(18px);
            box-shadow: 0 0 40px rgba(0,0,0,0.6), 0 0 80px rgba(255, 46, 104, 0.6);
        }

        .header { text-align: center; margin-bottom: 2rem; }
        .emoji { font-size: 2.5rem; margin-bottom: 0.5rem; }
        h1 { font-size: clamp(2.2rem, 4vw, 3rem); margin-bottom: 0.5rem; }
        .btitle { color: rgba(255,255,255,0.8); font-size: 1rem; }

        /* Form styles */
        .form-group { margin-bottom: 1.3rem; }
        label { display: block; margin-bottom: 0.4rem; font-size: 0.9rem; opacity: 0.85; }
        input[type="text"], input[type="email"], input[type="tel"] {
            width: 100%; padding: 0.75rem 1rem; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.25);
            background: rgba(15, 10, 35, 0.85); color: #fff; outline: none; transition: 0.2s ease;
        }
        input:focus { border-color: #ffdd59; box-shadow: 0 0 12px rgba(255,221,89,0.6); }

        /* Ticket selector */
        .ticket-selector { display: grid; gap: 1rem; }
        .ticket-option {
            display: flex; align-items: center; justify-content: space-between;
            padding: 1rem 1.2rem; border-radius: 16px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.25); cursor: pointer;
            transition: 0.25s ease;
        }
        .ticket-option:hover { background: rgba(255,255,255,0.15); }
        .ticket-option input { display: none; }
        .ticket-option.selected { border-color: #ffdd59; background: rgba(255,221,89,0.12); box-shadow: 0 0 20px rgba(255,221,89,0.5); }
        .ticket-name { font-size: 1rem; font-weight: 600; }
        .ticket-price { font-size: 1rem; opacity: 0.9; }

        /* Payment method */
        .payment-methods { display: grid; gap: 1rem; }
        .payment-method {
            display: flex; align-items: center; padding: 1rem 1.2rem; border-radius: 16px;
            cursor: pointer; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.25); transition: 0.2s; gap:1rem;
        }
        .payment-method.selected { border-color: #ff3f34; background: rgba(255,80,80,0.15); box-shadow:0 0 24px rgba(255,70,70,0.6);}
        .method-icon { font-size: 1.6rem; }

        .alert-info { margin-top: 1rem; background: rgba(255,255,255,0.1); padding:0.9rem 1rem; border-radius:12px; font-size:0.85rem; border-left:3px solid #ffdd59; }

        .btn-primary {
            width: 100%; display:flex; align-items:center; justify-content:center;
            padding:1rem 1.2rem; font-size:1rem; font-weight:600; border-radius:999px; border:none; cursor:pointer;
            margin-top:1.5rem; background-image: linear-gradient(120deg, #ff3f34, #ff9f1a);
            color:#0b0414; box-shadow: 0 0 30px rgba(255,99,71,0.8); transition:0.25s ease;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 45px rgba(255,165,0,1);}


        #ticketQuantity {
    width: 120px; /* ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑÿπÿ±ÿ∂ */
    padding: 0.6rem 0.8rem;
    font-size: 1rem;
    font-weight: 600;
    text-align: center;
    color: #fff;
    background: rgba(15, 10, 35, 0.85);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 12px;
    outline: none;
    transition: all 0.25s ease;
    box-shadow: 0 4px 20px rgba(255,255,255,0.05), 0 0 10px rgba(255,221,89,0.2);
}

#ticketQuantity:focus {
    border-color: #ffdd59;
    box-shadow: 0 0 12px rgba(255,221,89,0.6);
}

/* ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ£ÿ≥ŸáŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑÿπÿØÿØ */
#ticketQuantity::-webkit-outer-spin-button,
#ticketQuantity::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
#ticketQuantity[type=number] {
    -moz-appearance: textfield;
}

/* ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ÿ≤ÿßÿ¶ÿØ ŸàŸÜÿßŸÇÿµ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) */
.quantity-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.quantity-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: rgba(255,255,255,0.1);
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.quantity-btn:hover {
    background: rgba(255,221,89,0.2);
    transform: scale(1.1);
}
    </style>
</head>
<body>

    <div class="gradient-overlay"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>

    <div class="page">
        <div class="card">
            <div class="header">
                <div class="emoji">üéâüéäüéà</div>
                <h1>Epic College Party</h1>
                <p class="btitle">Secure Your Spot - Limited Tickets Available!</p>
            </div>

            <form id="ticketForm">
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" required placeholder="Enter your name">
                </div>

                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" required placeholder="your.email@example.com">
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" placeholder="+20 123 456 7890">
                </div>

                <div class="form-group">
                    <label>Select Your Ticket *</label>
                    <div class="ticket-selector">
                        <label class="ticket-option selected">
                            <input type="radio" name="ticketType" value="standard" data-price="50" checked>
                            <div class="ticket-name">üé´ Standard</div>
                            <div class="ticket-price">50 EGP</div>
                        </label>
                        <label class="ticket-option">
                            <input type="radio" name="ticketType" value="vip" data-price="100">
                            <div class="ticket-name">üëë VIP Access</div>
                            <div class="ticket-price">100 EGP</div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
    <label for="ticketQuantity">ÿπÿØÿØ ÿßŸÑÿ™ÿ∞ÿßŸÉÿ± *</label>
    <div class="quantity-wrapper">
        <button type="button" class="quantity-btn" id="decrease">-</button>
        <input type="number" id="ticketQuantity" min="1" value="1">
        <button type="button" class="quantity-btn" id="increase">+</button>
    </div>
</div>

<div class="form-group">
    <p>ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä: <span id="totalPrice">50</span> EGP</p>
</div>

                <div class="form-group">
                    <label>Payment Method *</label>
                    <div class="payment-methods">
                        <label class="payment-method selected">
                            <input type="radio" name="paymentMethod" value="card" checked>
                            <div class="method-icon">üí≥</div>
                            <div class="method-name">Card</div>
                        </label>
                        <label class="payment-method">
                            <input type="radio" name="paymentMethod" value="wallet">
                            <div class="method-icon">üì±</div>
                            <div class="method-name">Mobile Wallet</div>
                        </label>
                    </div>
                </div>

                <div class="alert-info">
                    <strong>Demo Mode:</strong> This is a demonstration. No real payment will be processed.
                </div>

                <button type="submit" class="btn-primary">üéâ Pay Now & Get Your Ticket</button>
            </form>
        </div>
    </div>

    <!-- =========================
         JAVASCRIPT
    ========================== -->
    <script>
        // Supabase Init
        const SUPABASE_URL = "https://ocnobfbigglpxoxsevkt.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jbm9iZmJpZ2dscHhveHNldmt0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4OTMzNjgsImV4cCI6MjA4MDQ2OTM2OH0.WONrpTEFiESu9t3Olq0LAnpuaXkwxRRfD8SzpBtNdMM";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const API_BASE_URL = 'https://qr-ticket-system-7dcnjele7-ahmads-projects-d17500c2.vercel.app';

        // Save Ticket to Supabase
        async function saveTicket(formData) {
            const { data, error } = await supabaseClient.from('tickets').insert([{
    full_name: formData.user.fullName,
    email: formData.user.email,
    phone: formData.user.phone,
    ticket_type: formData.ticket.type,
    price: formData.ticket.price,         // ÿ≥ÿπÿ± ÿßŸÑÿ™ÿ∞ŸÉÿ±ÿ© ÿßŸÑŸàÿßÿ≠ÿØÿ©
    quantity: formData.ticket.quantity,   // ÿπÿØÿØ ÿßŸÑÿ™ÿ∞ÿßŸÉÿ±
    total_price: formData.ticket.totalPrice, // ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä
    payment_method: formData.paymentMethod,
    event_name: formData.ticket.eventName,
    paid: false,
    created_at: new Date()
}]);
            if (error) {
                console.log("Supabase Error:", error);
                alert("Error saving data: " + error.message);
                return false;
            }
            console.log("Saved to Supabase:", data);
            return true;
        }

        // Ticket selection UI
        document.querySelectorAll('.ticket-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.ticket-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                option.querySelector('input[type="radio"]').checked = true;
            });
        });

        // Payment method UI
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', () => {
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                method.classList.add('selected');
                method.querySelector('input[type="radio"]').checked = true;
            });
        });

        const ticketQuantityInput = document.getElementById('ticketQuantity');
const totalPriceDisplay = document.getElementById('totalPrice');

function updateTotalPrice() {
    const selectedTicket = document.querySelector('input[name="ticketType"]:checked');
    const pricePerTicket = parseFloat(selectedTicket.dataset.price);
    const quantity = parseInt(ticketQuantityInput.value) || 1;
    const total = pricePerTicket * quantity;
    totalPriceDisplay.textContent = total;
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿπÿ± ÿπŸÜÿØ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜŸàÿπ ÿ£Ÿà ÿßŸÑÿπÿØÿØ
document.querySelectorAll('input[name="ticketType"]').forEach(radio => {
    radio.addEventListener('change', updateTotalPrice);
});
ticketQuantityInput.addEventListener('input', updateTotalPrice);

// ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿ£ŸàŸÑ ŸÖÿ±ÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
updateTotalPrice();
        // Form submit
        document.getElementById('ticketForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const btn = document.querySelector('.btn-primary');
            btn.disabled = true;
            btn.textContent = 'Processing...';

            const formData = {
                user: {
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value || null
                },
                ticket: {
    type: document.querySelector('input[name="ticketType"]:checked').value,
    price: parseFloat(document.querySelector('input[name="ticketType"]:checked').dataset.price),
    quantity: parseInt(ticketQuantityInput.value) || 1,
    totalPrice: parseFloat(document.querySelector('input[name="ticketType"]:checked').dataset.price) * (parseInt(ticketQuantityInput.value) || 1),
    eventName: 'Epic College Party'
},
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value
            };

            // Save to Supabase first
            const saved = await saveTicket(formData);
            if (!saved) {
                btn.disabled = false;
                btn.textContent = 'üéâ Pay Now & Get Your Ticket';
                return;
            }

            // Then process payment simulation
            try {
                const response = await fetch(`${API_BASE_URL}/api/payments/simulate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success && data.paymentUrl) {
                    window.location.href = data.paymentUrl;
                } else {
                    throw new Error(data.error || 'Failed to initiate payment');
                }

            } catch (error) {
                console.error('Payment error:', error);
                alert('Failed to process payment: ' + error.message);
                btn.disabled = false;
                btn.textContent = 'üéâ Pay Now & Get Your Ticket';
            }
        });


        const decreaseBtn = document.getElementById('decrease');
const increaseBtn = document.getElementById('increase');

decreaseBtn.addEventListener('click', () => {
    ticketQuantityInput.value = Math.max(1, parseInt(ticketQuantityInput.value) - 1);
    updateTotalPrice();
});

increaseBtn.addEventListener('click', () => {
    ticketQuantityInput.value = parseInt(ticketQuantityInput.value) + 1;
    updateTotalPrice();
});
    </script>
</body>
</html>
